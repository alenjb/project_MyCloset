<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycloset.notice.mapper.NoticeMapper">
	<!-- 1.리스트(list) -->

	<select id="getListWithPaging"
		resultType="com.mycloset.notice.vo.NoticeVO">
		<![CDATA[
		SELECT 
		no, 
		title, 
		writer, 
		writeDate, 
		endDate
		FROM(
			SELECT 
			(@ROWNUM:=@ROWNUM+1) AS RNUM, 
			no, 
			title, 
			writer, 
			writeDate, 
			endDate
			FROM(
				SELECT 
				no, 
				title, 
				writer, 
				writeDate, 
				endDate
				FROM notice
		ORDER BY writeDate DESC
		) AS A, (SELECT @ROWNUM:=0) AS B
		) AS C
		WHERE]]>
		<include refid="criteria" /> <![CDATA[(@rownum:=0)=0]]>
		limit 0, #{limitMax}
	</select>

	<!-- <select id="list" resultType="com.mycloset.notice.vo.NoticeVO"> -->
	<!-- <![CDATA[ -->
	<!-- select no, title, writer, writeDate, endDate -->
	<!-- from( -->
	<!-- select (@ROWNUM:=@ROWNUM+1) AS RNUM, no, title, writer, writeDate, 
		endDate -->
	<!-- from( -->
	<!-- select no, title, writer, writeDate, endDate -->
	<!-- from notice -->
	<!-- where 1=1]]> -->
	<!-- <include refid="search"/> -->
	<!-- <![CDATA[ -->
	<!-- order by writeDate desc -->
	<!-- ) AS A, (SELECT @ROWNUM:=0) AS B -->

	<!-- ) AS C -->
	<!-- WHERE C.RNUM <= #{pageNum} * #{amount} AND C.RNUM > (#{pageNum} - 1) 
		* #{amount} -->
	<!-- ]]> -->
	<!-- </select> -->


	<!-- 검색 처리 태그 -->
	<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item="type" collection="cri.typeArr">
				<trim prefix="OR">
					<choose>
						<when test="type == 'T'.toString()">
							title LIKE CONCAT('%', #{cri.keyword}, '%')
						</when>
						<when test="type == 'C'.toString()">
							content LIKE CONCAT('%', #{cri.keyword}, '%')
						</when>
						<when test="type == 'W'.toString()">
							writer LIKE CONCAT('%', #{cri.keyword}, '%')
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>


	<!-- 총 게시물 개수 세기 -->
	<select id="getTotalNum" resultType="Integer">
	SELECT count(*) FROM notice
	WHERE <include refid="criteria"/>1=1 
	</select>

	<!-- 2.글보기(view) -->
	<select id="view" resultType="com.mycloset.notice.vo.NoticeVO">
		select no, title,content, writer,
		writeDate, endDate
		from notice
		where no =
		#{no}
	</select>

	<!-- 3.글쓰기(write) -->
	<insert id="write">
		insert into notice(title, content, writer, writeDate,
		endDate)
		values(#{title}, #{content}, #{writer}, CURDATE(), #{endDate})
	</insert>
	<!-- 4. 수정(update) -->
	<update id="update">
		update notice set title=#{title}, content=#{content},
		writer=#{writer},
		writeDate=CURDATE(), endDate=#{endDate}
		where no =
		#{no}
	</update>
	<!-- 5. 삭제(delete) -->
	<delete id="delete">
		delete from notice
		where no =#{no}
	</delete>
</mapper>