<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycloset.admin.mapper.AdminMapper">

<!-- 페이지 네이션을 적용한 리스트 가져오기 -->
	<select id="getListWithPaging" resultType="com.mycloset.admin.vo.AdminVO">
		<![CDATA[
			SELECT 
			@rownum:= @rownum +1 rownum, 
			member_id, 
			member_name, 
			member_sex, 
			member_phone, 
			member_email, 
			member_height, 
			member_top_size, 
			member_bottom_size,
			member_shoes_size, 
			member_face, 
			member_reg_date, 
			member_grade,
			member_status
			FROM member
			WHERE 1=1 
			]]>
			<include refid="criteria"/> 
<!-- 			<![CDATA[(@rownum:=0)=0]]> -->
			ORDER BY member_reg_date DESC
			LIMIT #{startNum}, #{cri.amount}
	
	<!-- 		limit (#{pageNum}-1) * #{amount}, #{pageNum} * #{amount} -->
	</select>
	<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item="type" collection="cri.typeArr">
				<trim prefix="OR">
					<choose>
						<when test="type == 'I'.toString()">
							member_id LIKE CONCAT('%', #{cri.keyword}, '%')
						</when>
						<when test="type == 'N'.toString()">
							member_name LIKE CONCAT('%', #{cri.keyword}, '%')
						</when>
						<when test="type == 'G'.toString()">
							member_grade LIKE CONCAT('%', #{cri.keyword}, '%')
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>

<!-- 멤버 상세 보기 -->
	<select id="view" resultType="com.mycloset.admin.vo.AdminVO">
	SELECT
	member_id, 
	member_name, 
	member_sex, 
	member_phone, 
	member_email, 
	member_height, 
	member_top_size, 
	member_bottom_size,
	member_shoes_size, 
	member_face, 
	member_reg_date, 
	member_grade,
	member_status
	FROM member
	WHERE #{member_id} = member_id
	</select>
<!-- 총 개수 세기 -->
	<select id="getTotalNum" resultType="Integer">
	SELECT count(*) FROM member
	WHERE <include refid="criteria"/>1=1 
	</select>
	
<!-- 회원등급변경 -->
	<update id="changeGrade">
	UPDATE member
	SET
	member_grade = #{grade}
	WHERE member_id = #{member_id}
	</update>
	
<!-- 회원상태변경 -->
	<update id="changeStatus">
	UPDATE member
	SET
	member_status = #{status}
	WHERE member_id = #{member_id}
	</update>
	
<!-- 회원강퇴 -->
	<delete id="delete">
	DELETE
	FROM member
	WHERE
	member_id =#{member_id}
	</delete>
</mapper>
