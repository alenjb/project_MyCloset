<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mycloset.notice.mapper.NoticeMapper">
<!-- 1.리스트(list) -->

<!-- pageObject 버전 -->
<select id="list" resultType="com.mycloset.notice.vo.NoticeVO">
		select no, title, writer, writeDate, endDate
		from(	
			select (@ROWNUM:=@ROWNUM+1) AS RNUM, no, title, writer, writeDate, endDate
			from(
				select no, title, writer, writeDate, endDate
				from notice
				where 1=1
				<include refid="search"/>
				order by writeDate desc
				) AS A, (SELECT @ROWNUM:=0) AS B
                
			) AS C
<!--  			아직 row 처리를 안함  -->
            where C.RNUM between #{startRow} and #{endRow}
</select>

<!-- <select id="list" resultType="com.mycloset.notice.vo.NoticeVO"> -->
<!-- <![CDATA[ -->
<!-- 		select no, title, writer, writeDate, endDate -->
<!-- 		from(	 -->
<!-- 			select (@ROWNUM:=@ROWNUM+1) AS RNUM, no, title, writer, writeDate, endDate -->
<!-- 			from( -->
<!-- 				select no, title, writer, writeDate, endDate -->
<!-- 				from notice -->
<!-- 				where 1=1]]> -->
<!-- 				<include refid="search"/> -->
<!-- 				<![CDATA[ -->
<!-- 				order by writeDate desc -->
<!-- 				) AS A, (SELECT @ROWNUM:=0) AS B -->
                
<!-- 			) AS C -->
<!--             WHERE C.RNUM  <= #{pageNum} * #{amount} AND C.RNUM > (#{pageNum} - 1) * #{amount}  -->
<!-- ]]> -->
<!-- </select> -->


<!-- 검색 처리 태그 -->
<sql id="search">
	<if test="word !=null and word!= ''.toString()">
		and (
		<if test="key == 't'.toString()">
			title like CONCAT('%', #{word}, '%')
		</if>
		<if test="key == 'c'.toString()">
			content like CONCAT('%', #{word}, '%')
		</if>
		<if test="key == 'tc'.toString()">
			title like CONCAT('%', #{word}, '%')
			
			or 	
			content like CONCAT('%', #{word}, '%')
		</if>
		)
	</if>
</sql>


<!-- 1-1 전체 데이터 개수(getTotalRow) -->
<select id="getTotalRow" resultType="long">
	select count(*)
	from notice
	where 1=1
</select>

<!-- 2.글보기(view) -->
<select id="view" resultType="com.mycloset.notice.vo.NoticeVO">
	select no, title,content, writer, writeDate, endDate
		from notice
		where no =
		#{no}
</select>

<!-- 3.글쓰기(write) -->
<insert id="write">
	insert into notice(title, content, writer, writeDate, endDate)
	values(#{title}, #{content}, #{writer}, CURDATE(), #{endDate})
</insert>
<!-- 4. 수정(update) -->
<update id="update">
	update notice set title=#{title}, content=#{content}, writer=#{writer}, writeDate=CURDATE(), endDate=#{endDate}
	where no = #{no}
</update>
<!-- 5. 삭제(delete) -->
<delete id="delete">
	delete from notice
	where no =#{no}
</delete>
</mapper>